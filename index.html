<!DOCTYPE html>
<html>
  <head>
    <title>Nearby Restaurants</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      #map {
        height: 400px;
        width: 100%;
      }
      .controls {
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h2>üçΩÔ∏è Finder</h2>
    <div class="controls">
      Minimum Rating:
      <select id="rating">
        <option value="0">Any</option>
        <option value="3">3+</option>
        <option value="3.5">3.5+</option>
        <option value="4">4+</option>
        <option value="4.5">4.5+</option>
      </select>
      <button onclick="searchPlaces()">Search</button>
      <button onclick="searchRandom()">Whatever lah üé≤</button>
    </div>
    <div id="map"></div>
    <ul id="results"></ul>

    <script>
      let map, service, infowindow, userPos;

      function initMap() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              userPos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              map = new google.maps.Map(document.getElementById("map"), {
                center: userPos,
                zoom: 15,
              });

              infowindow = new google.maps.InfoWindow();
              service = new google.maps.places.PlacesService(map);

              new google.maps.Marker({
                position: userPos,
                map,
                title: "You are here",
              });
            },
            () => {
              alert("Geolocation failed!");
            }
          );
        } else {
          alert("Your browser does not support geolocation.");
        }
      }

      function searchPlaces() {
        const rating = parseFloat(document.getElementById("rating").value);
        const request = {
          location: userPos,
          radius: 3000,
          type: ["restaurant"],
        };

        service.nearbySearch(request, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            const filtered = results.filter((p) => p.rating >= rating);
            displayResults(filtered);
          }
        });
      }

      function searchRandom() {
        const rating = parseFloat(document.getElementById("rating").value);
        const request = {
          location: userPos,
          radius: 3000,
          type: ["restaurant"],
        };

        service.nearbySearch(request, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            const filtered = results.filter((p) => p.rating >= rating);

            if (filtered.length === 0) {
              Swal.fire({
                icon: "warning",
                title: "Oops...",
                text: "No restaurants found nearby!",
              });
              return;
            }

            const randomPlace =
              filtered[Math.floor(Math.random() * filtered.length)];
            displayResults([randomPlace]);

            Swal.fire({
              icon: "success",
              title: "Today's pick üéâ",
              html: `<b>${randomPlace.name}</b><br>‚≠ê Rating: ${
                randomPlace.rating || "N/A"
              }<br>üìç ${randomPlace.vicinity || ""}`,
            });
          }
        });
      }

      function displayResults(places) {
        const resultsList = document.getElementById("results");
        resultsList.innerHTML = "";
        places.forEach((place) => {
          const li = document.createElement("li");
          li.textContent = `${place.name} - ‚≠ê ${place.rating || "N/A"}`;
          resultsList.appendChild(li);

          const marker = new google.maps.Marker({
            map,
            position: place.geometry.location,
          });

          marker.addListener("click", () => {
            infowindow.setContent(place.name);
            infowindow.open(map, marker);
          });

          map.setCenter(place.geometry.location);
        });
      }
    </script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7JiHggis66nCLaEszgv4Np_YVL4t9qVI&libraries=places&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
